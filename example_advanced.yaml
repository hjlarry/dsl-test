name: "é«˜çº§å·¥ä½œæµç¤ºä¾‹"
version: "1.0"

global:
  threshold: "100"
  api_url: "https://jsonplaceholder.typicode.com"

nodes:
  # 1. è·å–éšæœºæ•°æ®
  - id: "fetch_post"
    type: "http"
    name: "è·å–å¸–å­æ•°æ®"
    params:
      method: "GET"
      url: "{{ global.api_url }}/posts/1"

  # 2. Python è„šæœ¬å¤„ç†æ•°æ®
  - id: "process_with_python"
    type: "script"
    name: "Python æ•°æ®å¤„ç†"
    needs: ["fetch_post"]
    params:
      language: "python"
      script: |
        import json
        import random
        
        # ç”Ÿæˆä¸€ä¸ªéšæœºåˆ†æ•°
        score = random.randint(50, 150)
        print(f"Generated score: {score}")
        
        # è¾“å‡º JSON
        result = {"score": score, "status": "processed"}
        print(json.dumps(result))

  # 3. Shell æå–åˆ†æ•° (ç›´æ¥ä» Python stdout æå–)
  - id: "extract_score"
    type: "shell"
    name: "æå–åˆ†æ•°"
    needs: ["process_with_python"]
    params:
      command: |
        echo "åˆ†æ•°å·²é€šè¿‡ Python ç”Ÿæˆ"
        # æ¨¡æ‹Ÿä»è¾“å‡ºä¸­æå–çš„å€¼ï¼Œå®é™…ä½¿ç”¨ä¸­å¯ä»¥åš JSON è§£æ
        echo "120"  # æ¨¡æ‹Ÿä¸€ä¸ªåˆ†æ•°

  # 4. æ¡ä»¶åˆ¤æ–­
  - id: "check_threshold"
    type: "switch"
    name: "æ£€æŸ¥æ˜¯å¦è¶…è¿‡é˜ˆå€¼"
    needs: ["extract_score"]
    params:
      # ä½¿ç”¨åµŒå¥—è®¿é—®ï¼šnodes.extract_score.output.stdout è·å–åˆ†æ•°
      condition: "120 > {{ global.threshold }}"
      true_value: "åˆ†æ•°è¶…è¿‡é˜ˆå€¼ï¼Œæ‰§è¡Œé«˜ä¼˜å…ˆçº§å¤„ç†"
      false_value: "åˆ†æ•°æœªè¾¾æ ‡ï¼Œæ‰§è¡Œå¸¸è§„å¤„ç†"

  # 5a. é«˜åˆ†å¤„ç† (ä»…å½“æ¡ä»¶ä¸ºçœŸæ—¶æ‰‹åŠ¨æ§åˆ¶)
  - id: "high_priority"
    type: "script"
    name: "JavaScript é«˜ä¼˜å…ˆçº§å¤„ç†"
    needs: ["check_threshold"]
    params:
      language: "javascript"
      script: |
        console.log("ğŸ‰ æ‰§è¡Œé«˜ä¼˜å…ˆçº§å¤„ç†!");
        console.log("æ¡ä»¶ç»“æœ: {{ nodes.check_threshold.output.result }}");
        
        const data = {
          priority: "high",
          timestamp: new Date().toISOString()
        };
        
        console.log(JSON.stringify(data, null, 2));

  # 5b. ä½åˆ†å¤„ç†
  - id: "normal_priority"
    type: "shell"
    name: "å¸¸è§„å¤„ç†"
    needs: ["check_threshold"]
    params:
      command: |
        echo "âš™ï¸ æ‰§è¡Œå¸¸è§„å¤„ç†"
        echo "æ¡ä»¶ç»“æœ: {{ nodes.check_threshold.output.result }}"

  # 6. æ±‡æ€»æŠ¥å‘Š
  - id: "final_report"
    type: "script"
    name: "ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š"
    needs: ["high_priority", "normal_priority"]
    params:
      language: "python"
      script: |
        print("=" * 50)
        print("ğŸ“Š å·¥ä½œæµæ‰§è¡ŒæŠ¥å‘Š")
        print("=" * 50)
        print("åŸå§‹åˆ†æ•°: {{ nodes.extract_score.output.stdout }}")
        print("é˜ˆå€¼: {{ global.threshold }}")
        print("æ¡ä»¶ç»“æœ: {{ nodes.check_threshold.output.result }}")
        print("=" * 50)
